(()=>{"use strict";var e={651:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function s(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.PipelineEditorProvider=void 0;const i=o(496);class r{constructor(e){this.context=e}static register(e){const t=new r(e);return i.window.registerCustomEditorProvider(r.viewType,t)}resolveCustomTextEditor(e,t,o){return n(this,void 0,void 0,(function*(){console.log("PipelineEditorProvider.resolveCustomTextEditor");const o=e.getText();if(""!==o&&!o.match(/implementation:\s*graph:/))return console.debug("PipelineEditorProvider.resolveCustomTextEditor. The document is not a valid pipeline ComponentSpec. Opening a text editor"),void i.commands.executeCommand("workbench.action.toggleEditorType",e.uri);function r(){console.debug("PipelineEditorProvider.updateWebview");const o=e.getText();t.webview.postMessage({type:"setComponentSpecText",data:o}),console.debug(`PipelineEditorProvider.updateWebview - sent ${o.length}`)}t.webview.options={enableScripts:!0},t.webview.html=yield this.getHtmlForWebview(t.webview,this.context.extensionUri);let c="";const a=i.workspace.onDidChangeTextDocument((t=>{t.document.uri.toString()===e.uri.toString()&&(e.getText().replace(/\r\n/g,"\n")!==c.replace(/\r\n/g,"\n")?(console.debug("PipelineEditorProvider.webviewPanel.webview.onDidChangeTextDocument - Document really changed (outside?) - Calling updateWebview()",t),r()):console.debug("PipelineEditorProvider.webviewPanel.webview.onDidChangeTextDocument - The changed document text is the same we've received before. - Not calling updateWebview()",t))}));t.onDidDispose((()=>{a.dispose()})),t.webview.onDidReceiveMessage((o=>n(this,void 0,void 0,(function*(){switch("rpc"!==(null==o?void 0:o.type)&&console.debug("PipelineEditorProvider.webviewPanel.webview.onDidReceiveMessage",o),o.type){case"VSCodeDocumentConnector:AddedEventListener":r();break;case"VSCodeDocumentConnector:ComponentSpecChanged":const a=o.data;c=a,e.getText().replace(/\r\n/g,"\n"),a.replace(/\r\n/g,"\n"),a.replace(/\r\n/g,"\n")!==e.getText().replace(/\r\n/g,"\n")&&(yield this.updateTextDocument(e,a));break;case"VSCodeDocumentConnector:InvalidDocumentPassedFromVSCode":console.debug("PipelineEditorProvider.onDidReceiveMessage.InvalidDocumentPassedFromVSCode."),i.window.showErrorMessage("The document is not a valid pipeline (graph component spec). Please file a bug report: https://github.com/Cloud-Pipelines/pipeline-editor/issues"),i.commands.executeCommand("workbench.action.toggleEditorType",e.uri);break;case"rpc":const d=o.data.messageId,l=o.data.func,u=o.data.args;(function(e,t,o){return n(this,void 0,void 0,(function*(){switch(t){case"VSCodeGlobalKeyValueStore:getData":{const[t,r]=o;return yield function(e,t,o="cache"){return n(this,void 0,void 0,(function*(){const n=o.replace(/\W/g,"_"),r=i.Uri.joinPath(e,"caches",n),c=yield s(t),a=i.Uri.joinPath(r,c+".value");try{const e=yield i.workspace.fs.readFile(a);return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}catch(e){return}}))}(e.globalStorageUri,r,t)}case"VSCodeGlobalKeyValueStore:setData":{const[t,r,c]=o;return yield function(e,t,o,r="cache"){return n(this,void 0,void 0,(function*(){const n=r.replace(/\W/g,"_"),c=i.Uri.joinPath(e,"caches",n),a=yield s(t),d=i.Uri.joinPath(c,a+".key"),l=i.Uri.joinPath(c,a+".value");yield i.workspace.fs.writeFile(l,new Uint8Array(o)),yield i.workspace.fs.writeFile(d,(new TextEncoder).encode(t))}))}(e.globalStorageUri,r,c,t)}case"VSCodeGlobalKeyValueStore:listKeys":{const[t]=o;return yield function(e,t="cache"){return n(this,void 0,void 0,(function*(){const o=t.replace(/\W/g,"_"),r=i.Uri.joinPath(e,"caches",o),s=(yield i.workspace.fs.readDirectory(r)).map((([e,t])=>e)).filter((e=>e.endsWith(".key")));return yield Promise.all(s.map((e=>n(this,void 0,void 0,(function*(){const t=i.Uri.joinPath(r,e),o=yield i.workspace.fs.readFile(t);return(new TextDecoder).decode(o)})))))}))}(e.globalStorageUri,t)}case"CloudPipelinesConfiguration:get":return function(){return n(this,void 0,void 0,(function*(){return i.workspace.getConfiguration("cloudPipelines")}))}();case"VSCodeWorkspaceComponents:getComponentRefByUri":{const[e]=o;return yield function(e){return n(this,void 0,void 0,(function*(){const t=yield i.workspace.fs.readFile(i.Uri.parse(e)),o=(new TextDecoder).decode(t);let n=e;for(const e of i.workspace.workspaceFolders||[])n=n.replace(e.uri.toString(),e.name);return{name:n,text:o}}))}(e)}case"VSCodeWorkspaceComponents:listUris":return yield function(){return n(this,void 0,void 0,(function*(){return(yield i.workspace.findFiles("**/component.yaml")).map((e=>e.toString()))}))}();case"promptSaveFileAsWithContent":{const[e,t]=o;return yield function(e,t){return n(this,void 0,void 0,(function*(){const o=void 0!==i.workspace.workspaceFolders&&i.workspace.workspaceFolders.length>0?i.workspace.workspaceFolders[0].uri:i.Uri.parse(""),n=i.Uri.joinPath(o,t),r=yield i.window.showSaveDialog({defaultUri:n});if(void 0!==r){const t=(new TextEncoder).encode(e);i.workspace.fs.writeFile(r,t)}}))}(e,t)}case"vscode.env.openExternal":{const[e]=o;return yield i.env.openExternal(i.Uri.parse(e))}default:return null}}))})(this.context,l,u).then((e=>{const o={type:"rpcResponse",data:{messageId:d,result:e}};t.webview.postMessage(o)}),(e=>{const o={type:"rpcResponse",data:{messageId:d,error:{reason:e}}};console.debug("PipelineEditorProvider RPC error response",JSON.stringify(o)),t.webview.postMessage(o)}));break;default:console.error("Unsupported message type:",o)}}))))}))}updateTextDocument(e,t){console.debug("PipelineEditorProvider.updateTextDocument");const o=new i.WorkspaceEdit;return o.replace(e.uri,new i.Range(0,0,e.lineCount,0),t),i.workspace.applyEdit(o)}getHtmlForWebview(e,t,o=!1){return n(this,void 0,void 0,(function*(){const n=i.Uri.joinPath(t,"build","index.html"),r=yield i.workspace.fs.readFile(n),s=(new TextDecoder).decode(r).toString(),c=i.Uri.joinPath(t,"build"),a=`<base href="${e.asWebviewUri(c).toString()+"/"}">`;let d=s.replace("<head>","<head>\n"+a);if(o){const t=function(){let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let o=0;o<32;o++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}(),o=`<meta http-equiv="Content-Security-Policy" content="${["default-src 'none'",`img-src ${e.cspSource}`,`style-src ${e.cspSource}`,`script-src 'nonce-${t}'`].join("; ")}">`;d=d.replace("<head>","<head>\n"+o+"\n"+o).replace(/<script/g,`<script nonce="${t}"`)}return d}))}}t.PipelineEditorProvider=r,r.viewType="cloudPipelines.pipelineEditor";const s=e=>n(void 0,void 0,void 0,(function*(){const t="string"==typeof e?(new TextEncoder).encode(e):e,o=yield crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(o)).map((e=>e.toString(16).padStart(2,"0"))).join("")}))},236:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function s(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.deactivate=t.activate=void 0;const i=o(496),r=o(651);t.activate=function(e){console.log('Congratulations, your extension "pipeline-editor" is now active in the web extension host!'),e.subscriptions.push(i.commands.registerCommand("cloud-pipeline-editor.newUntitledPipeline",(()=>n(this,void 0,void 0,(function*(){i.commands.executeCommand("vscode.openWith",i.Uri.parse("untitled:pipeline.component.yaml"),"cloudPipelines.pipelineEditor")}))))),e.subscriptions.push(r.PipelineEditorProvider.register(e)),console.log("PipelineEditorProvider.register(context) completed!")},t.deactivate=function(){}},496:e=>{e.exports=require("vscode")}},t={},o=function o(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,o),r.exports}(236),n=exports;for(var i in o)n[i]=o[i];o.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();